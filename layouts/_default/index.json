{{- $index := slice -}}
{{- range site.RegularPages -}}
    
    {{- /* 1. Smart Tips Extraction from {{< tag >}} shortcodes */ -}}
    {{- /* Logic: Converts '{{< tag "name" >}} content {{< /toggle >}}' into 'name ::: content |||' */ -}}
    {{- $tips := "" -}}
    {{- $matches := findRE "(?s)\\{\\{< tag \".*?\" >\\}\\}.*?\\{\\{< /toggle >\\}\\}" .RawContent -}}
    {{- range $matches -}}
        {{- $clean := . | replaceRE "(?s)\\{\\{< tag \"(.*?)\" >\\}\\}" "$1 ::: " | replaceRE "\\{\\{< /toggle >\\}\\}" " ||| " | replaceRE "\n" " " -}}
        {{- $tips = printf "%s%s" $tips $clean -}}
    {{- end -}}

    {{- /* 2. Description Logic: Hide description if tagged "blog" or "Blog" */ -}}
    {{- $desc := .Params.description -}}
    {{- if intersect (slice "blog" "Blog") (default slice .Params.tags) -}}
        {{- $desc = "" -}}
    {{- end -}}

    {{- /* 3. Build Search Object */ -}}
    {{- $item := dict 
        "title" .Title 
        "description" $desc   
        "summary" .Summary  
        "permalink" .Permalink 
        "tips" $tips  
        "tags" (default slice .Params.tags) 
    
    -}}
    
    {{- /* 4. Append */ -}}
    {{- $index = $index | append $item -}}
{{- end -}}

{{- /* 5. Output */ -}}
{{- $index | jsonify -}}